---
// BmiCalc.astro - Updated with testimonials and weight loss slider side by side
const testimonials = [
    { name: "Daryl", pounds: "72 POUNDS", image: "/images/slide2.jpg" },
    { name: "Sarah", pounds: "58 POUNDS", image: "/images/slide1.jpg" },
    { name: "Mary", pounds: "65 POUNDS", image: "/images/slide3.jpg" },
];

const features = [
    "Doctor-Trusted Ingredients",
    "U.S. Based Pharmacies",
    "Licensed Providers",
    "FSA/HSA Eligible",
    "Prescriptions Shipped straight to your door",
];
---

<section class="bmi-calculator-section">
    <div class="bmi-container">
        <!-- Left Panel: Testimonials Slideshow -->
        <div class="testimonial-slider-panel">
            <div class="testimonial-slideshow-bmi">
                {
                    testimonials.map((testimonial, index) => (
                        <div class={`slide-bmi ${index === 0 ? "active" : ""}`}>
                            <img
                                src={testimonial.image}
                                alt={testimonial.name}
                                class="testimonial-image-bmi"
                            />
                            <div class="testimonial-info-bmi">
                                <p class="testimonial-name-bmi">
                                    {testimonial.name}
                                </p>
                                <p class="testimonial-weight-bmi">
                                    Lost {testimonial.pounds}
                                </p>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>

        <!-- Middle Panel: Weight Loss Slider -->
        <div class="weight-slider-panel">
            <div class="slider-content">
                <p class="slider-label">You could lose:</p>

                <div class="weight-loss-display">
                    <span class="weight-number" id="sliderWeightLoss">40</span>
                    <span class="weight-unit">lbs</span>
                </div>

                <!-- Arrow Marker - ABOVE the bar chart -->
                <div class="chart-marker">▼</div>

                <div class="bar-chart" id="barChart">
                    <div class="chart-bars" id="chartBars">
                        <!-- Bars will be generated dynamically -->
                    </div>
                </div>

                <div class="starting-weight-section">
                    <p class="starting-label">Starting weight:</p>
                    <div class="starting-weight-badge">
                        <span class="badge-value" id="sliderStartingWeight"
                            >200</span
                        >
                        <span class="badge-unit">lbs</span>
                    </div>
                </div>

                <div class="weight-slider-container">
                    <input
                        type="range"
                        id="weightSlider"
                        class="weight-slider"
                        min="140"
                        max="400"
                        value="200"
                        step="1"
                    />
                    <div class="slider-gradient-bg"></div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Trust Card -->
        <div class="trust-card">
            <div class="trust-content">
                <h3 class="trust-title">Trusted Quality</h3>
                <ul class="trust-list">
                    {
                        features.map((feature) => (
                            <li>
                                <svg
                                    width="24"
                                    height="24"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                >
                                    <path
                                        d="M12 2L4 6v6c0 5.5 3.84 10.74 8 12 4.16-1.26 8-6.5 8-12V6l-8-4z"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        fill="none"
                                    />
                                    <path
                                        d="M9 12l2 2 4-4"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                    />
                                </svg>
                                <span>{feature}</span>
                            </li>
                        ))
                    }
                </ul>
            </div>
            <div class="doctor-image">
                <img src="/images/doctor.png" alt="Doctor" />
                <div class="doctor-badge">Licensed Providers</div>
            </div>
        </div>
    </div>
</section>

<!-- Weight Loss Results Modal -->
<div class="weight-modal-overlay" id="weightModal">
    <div class="weight-modal-container">
        <button
            class="weight-modal-close"
            id="closeWeightModal"
            aria-label="Close"
        >
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                <path
                    d="M18 6L6 18M6 6l12 12"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"></path>
            </svg>
        </button>

        <div class="weight-modal-content">
            <!-- Left Side: 20% Info -->
            <div class="weight-modal-left">
                <p class="modal-average-label">Lose up to:</p>
                <div class="modal-percentage">
                    20<span class="percent-symbol">%</span>
                </div>
                <p class="modal-percentage-text">
                    of your body weight with 5MinuteMeds
                </p>

                <button class="modal-get-started-btn">Get started</button>

                <p class="modal-disclaimer">
                    *In clinical trials lasting 68 and 72 weeks, patients
                    without diabetes who used Wegovy (2.4 mg) and Zepbound (15
                    mg) alongside diet and exercise saw significant weight loss.
                    Those with a BMI ≥30, or a BMI ≥27 with a weight-related
                    condition, experienced an average weight loss of 15% and
                    20%, respectively. In comparison, participants who only made
                    diet and exercise changes lost 2.4% and 3.1% on average.
                </p>
            </div>

            <!-- Right Side: Weight Loss Visual -->
            <div class="weight-modal-right">
                <div class="modal-weight-card">
                    <div class="modal-starting-badge">
                        <span class="modal-badge-label">Starting weight:</span>
                        <span class="modal-badge-value" id="modalStartingWeight"
                            >200</span
                        >
                        <span class="modal-badge-unit">lbs</span>
                    </div>

                    <p class="modal-lose-label">You could lose:</p>

                    <div class="modal-weight-loss">
                        <span class="modal-loss-number" id="modalWeightLoss"
                            >40</span
                        >
                        <span class="modal-loss-unit">lbs</span>
                    </div>

                    <!-- Arrow Marker - ABOVE the bar chart in modal -->
                    <div class="modal-chart-marker">▼</div>

                    <div class="modal-bar-chart">
                        <div class="modal-chart-bars" id="modalChartBars">
                            <!-- Bars generated dynamically -->
                        </div>
                    </div>

                    <div class="modal-slider-container">
                        <div class="modal-slider-gradient"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- BMI Results Modal -->
<div class="bmi-results-modal-overlay" id="bmiResultsModal">
    <div class="bmi-results-modal-container">
        <button
            class="bmi-results-modal-close"
            id="closeBMIResultsModal"
            aria-label="Close"
        >
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                <path
                    d="M18 6L6 18M6 6l12 12"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"></path>
            </svg>
        </button>

        <div class="bmi-results-modal-grid">
            <!-- Left Side: BMI Circle -->
            <div class="bmi-results-modal-left">
                <h2 class="bmi-results-modal-title">Body Mass Index</h2>

                <div class="bmi-results-circle-container">
                    <svg class="bmi-results-circle" viewBox="0 0 200 200">
                        <circle
                            cx="100"
                            cy="100"
                            r="80"
                            fill="none"
                            stroke="#f0f0f0"
                            stroke-width="16"></circle>
                        <circle
                            id="bmiResultsArc"
                            cx="100"
                            cy="100"
                            r="80"
                            fill="none"
                            stroke="#89cff0"
                            stroke-width="16"
                            stroke-dasharray="502"
                            stroke-dashoffset="125"
                            stroke-linecap="round"
                            transform="rotate(-90 100 100)"></circle>
                    </svg>
                    <div class="bmi-results-value-container">
                        <div class="bmi-results-value" id="bmiResultsValue">
                            0
                        </div>
                        <div class="bmi-results-label">Your BMI</div>
                    </div>
                </div>

                <div class="bmi-results-explanation">
                    <p>
                        Body Mass Index (BMI) is a measurement tool that uses
                        your height and weight to estimate if your weight is in
                        a healthy range for your height.*
                    </p>
                </div>
            </div>

            <!-- Right Side: Category Info -->
            <div class="bmi-results-modal-right">
                <div
                    class="bmi-results-category-alert"
                    id="categoryResultsAlert"
                >
                    <div class="bmi-results-alert-header">
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <path
                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                        </svg>
                        <span
                            class="bmi-results-alert-category"
                            id="alertResultsCategory">Underweight</span
                        >
                        <span
                            class="bmi-results-alert-range"
                            id="alertResultsRange">&lt; 18.5</span
                        >
                    </div>
                    <p class="bmi-results-alert-text" id="alertResultsText">
                        Your BMI is below the healthy range.
                    </p>
                    <button class="bmi-results-consultation-btn"
                        >Start Consultation</button
                    >
                </div>

                <div class="bmi-results-categories">
                    <div class="bmi-results-category-item">
                        <div class="bmi-results-category-dot healthy"></div>
                        <span class="bmi-results-category-name"
                            >Healthy Weight</span
                        >
                        <span class="bmi-results-category-range">18.5+</span>
                    </div>
                    <div class="bmi-results-category-item">
                        <div class="bmi-results-category-dot overweight"></div>
                        <span class="bmi-results-category-name">Overweight</span
                        >
                        <span class="bmi-results-category-range">25+</span>
                    </div>
                    <div class="bmi-results-category-item">
                        <div class="bmi-results-category-dot obese"></div>
                        <span class="bmi-results-category-name">Obesity</span>
                        <span class="bmi-results-category-range">30+</span>
                    </div>
                </div>

                <div class="bmi-results-disclaimers">
                    <p>
                        *BMI doesn't directly measure body fat and may not
                        accurately reflect health for people with high muscle
                        mass, pregnant women, children, older adults, certain
                        ethnic groups, or those with medical conditions.
                    </p>
                    <p>
                        The BMI calculator does not determine eligibility for
                        weight loss treatments. A healthcare provider must
                        evaluate your overall health and history to decide if
                        treatment is right for you.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .bmi-calculator-section {
        margin: 16px auto;
    }

    .bmi-container {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 16px;
        align-items: stretch;
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Trust Card */
    .trust-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
        border-radius: 40px;
        padding: 24px;
        display: flex;
        flex-direction: column;
        color: #030303;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 24px rgba(0, 112, 218, 0.12);
        border: 2px solid rgba(0, 112, 218, 0.1);
    }

    .trust-title {
        font-family: "Sofia";
        font-size: 22px;
        font-weight: 400;
        color: #0070da;
        margin: 0 0 16px 0;
    }

    .trust-content {
        flex: 1;
        z-index: 2;
    }

    .trust-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 16px;
        padding: 0;
    }

    .trust-list li {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        font-weight: 500;
        padding: 8px 12px;
        border-radius: 12px;
        transition: all 0.3s ease;
    }

    .trust-list li:hover {
        background: rgba(255, 255, 255, 0.9);
        transform: translateX(4px);
    }

    .trust-list svg {
        width: 20px;
        height: 20px;
        stroke: #0070da;
        flex-shrink: 0;
    }

    .doctor-image {
        position: relative;
        height: 140px;
        margin-top: auto;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        margin-bottom: -24px;
    }

    .doctor-image img {
        object-fit: contain;
        width: 180px;
        filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
    }

    .doctor-badge {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: linear-gradient(135deg, #0070da 0%, #00a2ff 100%);
        color: white;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        font-family: "Inter";
        box-shadow: 0 4px 12px rgba(0, 112, 218, 0.3);
    }

    /* Testimonial Slideshow Panel */
    .testimonial-slider-panel {
        background-color: #ffffff;
        border-radius: 40px;
        box-shadow: 2px 4px 12px #00000014;
        overflow: hidden;
    }

    .testimonial-slideshow-bmi {
        background: linear-gradient(135deg, #00295f 0%, #004080 100%);
        position: relative;
        overflow: hidden;
        min-height: 100%;
        height: 100%;
    }

    .slide-bmi {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        display: flex;
        flex-direction: column;
    }

    .slide-bmi.active {
        opacity: 1;
        z-index: 1;
    }

    .testimonial-image-bmi {
        width: 100%;
        height: 65%;
        object-fit: cover;
        object-position: center top;
    }

    .testimonial-info-bmi {
        background: linear-gradient(135deg, #278fc3 0%, #00295f 100%);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
    }

    .testimonial-name-bmi {
        font-family: "Sofia";
        font-size: 22px;
        font-weight: 400;
        color: white;
        margin: 0;
    }

    .testimonial-weight-bmi {
        font-size: 13px;
        font-weight: 600;
        color: white;
        margin: 0;
        font-family: "Inter";
    }

    /* Left Panel: BMI Input Form */
    .bmi-input-panel {
        background-color: #ffffff;
        border-radius: 40px;
        padding: 32px 28px;
        box-shadow: 2px 4px 12px #00000014;
    }

    .bmi-title {
        font-family: "Sofia";
        font-size: 28px;
        font-weight: 400;
        color: #030303;
        margin-bottom: 6px;
    }

    .bmi-subtitle {
        font-size: 14px;
        color: #666;
        margin-bottom: 16px;
        font-weight: 400;
        font-family: "Inter";
    }

    .bmi-display {
        font-size: 100px;
        font-weight: 700;
        color: #030303;
        margin-bottom: 16px;
        line-height: 1;
    }

    .form-group {
        margin-bottom: 16px;
    }

    .form-label {
        display: block;
        font-size: 14px;
        color: #030303;
        margin-bottom: 10px;
        font-weight: 500;
        font-family: "Inter";
    }

    .input-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    .input-wrapper {
        position: relative;
        background-color: #f8f8f8;
        border-radius: 14px;
        border: 2px solid transparent;
        transition: all 0.3s ease;
    }

    .input-wrapper.single {
        grid-column: 1 / -1;
    }

    .input-wrapper:focus-within {
        border-color: #0070da;
        background-color: #ffffff;
    }

    .form-input {
        width: 100%;
        padding: 14px 16px;
        font-size: 15px;
        border: none;
        background: transparent;
        outline: none;
        color: #030303;
        font-family: "Inter";
    }

    .form-input::placeholder {
        color: #999;
    }

    .input-unit {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 14px;
        color: #666;
        pointer-events: none;
        font-family: "Inter";
    }

    .calculate-btn {
        width: 100%;
        padding: 16px;
        background: linear-gradient(
            135deg,
            #ff6b9d 0%,
            #ffa06b 50%,
            #ffd56b 100%
        );
        border: 2px solid transparent;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 600;
        color: #030303;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Inter";
    }

    .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 107, 157, 0.3);
        border-color: #0070da;
    }

    .calculate-btn:active {
        transform: translateY(0);
    }

    /* Right Panel: Weight Slider */
    .weight-slider-panel {
        background-color: #ffffff;
        border-radius: 40px;
        padding: 20px 20px;
        box-shadow: 2px 4px 12px #00000014;
        display: flex;
        flex-direction: column;
    }

    .slider-content {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .slider-label {
        font-size: 18px;
        color: #666;
        margin-bottom: 12px;
        text-align: center;
        font-family: "Inter";
    }

    .weight-loss-display {
        text-align: center;
        margin-bottom: 8px;
    }

    .weight-number {
        font-size: 100px;
        font-weight: 700;
        color: #030303;
        line-height: 1;
    }

    .weight-unit {
        font-size: 40px;
        font-weight: 400;
        color: #030303;
    }

    /* Arrow Marker - Now ABOVE the bar chart */
    .chart-marker {
        text-align: center;
        font-size: 28px;
        color: #4e9a69;
        margin-bottom: 4px;
        line-height: 1;
    }

    /* Bar Chart with Slider-Based Animation */
    .bar-chart {
        position: relative;
        margin-bottom: 16px;
        overflow: hidden;
        height: 120px;
        width: 100%;
    }

    .chart-bars {
        position: absolute;
        left: 0;
        top: 0;
        display: flex;
        align-items: center;
        height: 120px;
        background-color: transparent;
        transition: transform 0.15s ease-out;
        gap: 3px;
    }

    .chart-bar {
        flex-shrink: 0;
        width: 8px;
        background-color: #7cb892;
        border-radius: 4px;
    }

    /* Starting Weight Section */
    .starting-weight-section {
        text-align: center;
        margin-bottom: 16px;
    }

    .starting-label {
        font-size: 16px;
        color: #666;
        margin-bottom: 10px;
        font-family: "Inter";
    }

    .starting-weight-badge {
        display: inline-flex;
        align-items: baseline;
        gap: 6px;
        background-color: #00875a;
        color: #ffffff;
        padding: 12px 24px;
        border-radius: 14px;
        font-weight: 600;
    }

    .badge-value {
        font-size: 28px;
        font-weight: 700;
    }

    .badge-unit {
        font-size: 18px;
    }

    /* Weight Slider */
    .weight-slider-container {
        position: relative;
        margin-top: 16px;
    }

    .slider-gradient-bg {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 10px;
        transform: translateY(-50%);
        background: linear-gradient(
            to right,
            #ffa06b 0%,
            #fb6fec 25%,
            #84a9fa 50%,
            #90dcf7 75%,
            #c7e9ab 100%
        );
        border-radius: 16px;
        pointer-events: none;
    }

    .weight-slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 10px;
        background: transparent;
        outline: none;
        position: relative;
        z-index: 2;
        cursor: pointer;
    }

    .weight-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 36px;
        height: 36px;
        background-color: #ffffff;
        border: 3px solid #4e9a69;
        border-radius: 50%;
        cursor: grab;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
    }

    .weight-slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    }

    .weight-slider::-webkit-slider-thumb:active {
        cursor: grabbing;
        transform: scale(1.05);
    }

    .weight-slider::-moz-range-thumb {
        width: 36px;
        height: 36px;
        background-color: #ffffff;
        border: 3px solid #4e9a69;
        border-radius: 50%;
        cursor: grab;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
    }

    .weight-slider::-moz-range-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    }

    .weight-slider::-moz-range-thumb:active {
        cursor: grabbing;
        transform: scale(1.05);
    }

    /* Weight Loss Modal */
    .weight-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        visibility: hidden;
        transition:
            opacity 0.3s ease,
            visibility 0.3s ease;
    }

    .weight-modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .weight-modal-container {
        background-color: #f5f5f5;
        border-radius: 40px;
        width: 100%;
        padding: 40px;
        position: relative;
        box-shadow: 2px 4px 12px #00000014;
        transform: scale(0.9);
        transition: transform 0.3s ease;
        max-height: 90vh;
        overflow-y: auto;
    }

    .weight-modal-overlay.active .weight-modal-container {
        transform: scale(1);
    }

    .weight-modal-close {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 34px;
        height: 34px;
        background-color: #030303;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        padding: 0;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        z-index: 10;
    }

    .weight-modal-close:hover {
        transform: rotate(90deg);
        background-color: #333;
    }

    .weight-modal-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
    }

    /* Modal Left Side */
    .weight-modal-left {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .modal-average-label {
        font-size: 18px;
        color: #030303;
        margin-bottom: 12px;
        font-family: "Inter";
    }

    .modal-percentage {
        font-size: 120px;
        font-weight: 700;
        color: #030303;
        line-height: 1;
        margin-bottom: 12px;
    }

    .percent-symbol {
        font-size: 70px;
    }

    .modal-percentage-text {
        font-size: 18px;
        color: #030303;
        margin-bottom: 24px;
        font-family: "Inter";
    }

    .modal-get-started-btn {
        width: 100%;
        padding: 16px 32px;
        background-color: #030303;
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 20px;
        font-family: "Inter";
    }

    .modal-get-started-btn:hover {
        background-color: #333;
        transform: translateY(-2px);
        box-shadow: 2px 4px 12px #00000014;
    }

    .modal-disclaimer {
        font-size: 12px;
        color: #666;
        line-height: 1.6;
        font-family: "Inter";
    }

    /* Modal Right Side */
    .weight-modal-right {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-weight-card {
        background: linear-gradient(
            135deg,
            #e8f4ff 0%,
            #f8f4ff 50%,
            #fff8f4 100%
        );
        border: 3px solid;
        border-image: linear-gradient(135deg, #84a9fa, #fb6fec, #ffa06b) 1;
        border-radius: 32px;
        padding: 32px 28px;
        width: 100%;
        max-width: 450px;
        box-shadow: 2px 4px 12px #00000014;
    }

    .modal-starting-badge {
        display: inline-flex;
        align-items: baseline;
        gap: 6px;
        background-color: #00875a;
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        font-family: "Inter";
    }

    .modal-badge-label {
        font-size: 13px;
        font-weight: 500;
    }

    .modal-badge-value {
        font-size: 24px;
        font-weight: 700;
    }

    .modal-badge-unit {
        font-size: 16px;
    }

    .modal-lose-label {
        font-size: 16px;
        color: #666;
        margin-bottom: 12px;
        text-align: center;
        font-family: "Inter";
    }

    .modal-weight-loss {
        text-align: center;
        margin-bottom: 8px;
    }

    .modal-loss-number {
        font-size: 90px;
        font-weight: 700;
        color: #030303;
        line-height: 1;
    }

    .modal-loss-unit {
        font-size: 36px;
        font-weight: 400;
        color: #030303;
    }

    /* Modal Arrow Marker - ABOVE the bar chart */
    .modal-chart-marker {
        text-align: center;
        font-size: 24px;
        color: #4e9a69;
        margin-bottom: 4px;
        line-height: 1;
    }

    .modal-bar-chart {
        position: relative;
        margin-bottom: 20px;
        overflow: hidden;
        height: 100px;
    }

    .modal-chart-bars {
        display: flex;
        align-items: center;
        height: 100%;
        background-color: transparent;
        gap: 2px;
    }

    .modal-chart-bar {
        flex-shrink: 0;
        width: 6px;
        background-color: #7cb892;
        border-radius: 4px;
    }

    .modal-slider-container {
        height: 10px;
        border-radius: 16px;
        overflow: hidden;
    }

    .modal-slider-gradient {
        height: 100%;
        background: linear-gradient(
            to right,
            #ffa06b 0%,
            #fb6fec 25%,
            #84a9fa 50%,
            #90dcf7 75%,
            #c7e9ab 100%
        );
    }

    /* BMI Results Modal */
    .bmi-results-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        visibility: hidden;
        transition:
            opacity 0.3s ease,
            visibility 0.3s ease;
    }

    .bmi-results-modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .bmi-results-modal-container {
        background-color: #ffffff;
        border-radius: 40px;
        width: 100%;
        padding: 40px;
        position: relative;
        box-shadow: 2px 4px 12px #00000014;
        transform: scale(0.9);
        transition: transform 0.3s ease;
        max-height: 90vh;
        overflow-y: auto;
    }

    .bmi-results-modal-overlay.active .bmi-results-modal-container {
        transform: scale(1);
    }

    .bmi-results-modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 6px;
        color: #030303;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease;
        z-index: 10;
    }

    .bmi-results-modal-close:hover {
        transform: rotate(90deg);
    }

    .bmi-results-modal-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
    }

    .bmi-results-modal-left {
        background: linear-gradient(135deg, #f8f4ff 0%, #fff8f4 100%);
        border: 3px solid;
        border-image: linear-gradient(135deg, #ff6b9d, #ffa06b, #ffd56b) 1;
        border-radius: 28px;
        padding: 32px 28px;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: 2px 4px 12px #00000014;
    }

    .bmi-results-modal-title {
        font-family: "Sofia";
        font-size: 28px;
        font-weight: 400;
        color: #030303;
        margin-bottom: 24px;
        text-align: center;
    }

    .bmi-results-circle-container {
        position: relative;
        width: 240px;
        height: 240px;
        margin-bottom: 24px;
    }

    .bmi-results-circle {
        width: 100%;
        height: 100%;
    }

    .bmi-results-value-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

    .bmi-results-value {
        font-size: 56px;
        font-weight: 700;
        color: #030303;
        line-height: 1;
        margin-bottom: 6px;
    }

    .bmi-results-label {
        font-size: 14px;
        color: #666;
        font-family: "Inter";
    }

    .bmi-results-explanation {
        font-size: 13px;
        color: #666;
        line-height: 1.6;
        text-align: center;
        font-family: "Inter";
    }

    .bmi-results-modal-right {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .bmi-results-category-alert {
        background: linear-gradient(135deg, #e8f4ff 0%, #f0f8ff 100%);
        border: 2px solid #89cff0;
        border-radius: 20px;
        padding: 20px;
        box-shadow: 2px 4px 12px #00000014;
    }

    .bmi-results-alert-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
    }

    .bmi-results-alert-header svg {
        color: #0070da;
        flex-shrink: 0;
    }

    .bmi-results-alert-category {
        font-size: 18px;
        font-weight: 600;
        color: #030303;
        flex: 1;
        font-family: "Inter";
    }

    .bmi-results-alert-range {
        font-size: 14px;
        color: #666;
        font-weight: 500;
        font-family: "Inter";
    }

    .bmi-results-alert-text {
        font-size: 13px;
        color: #030303;
        line-height: 1.6;
        margin-bottom: 16px;
        font-family: "Inter";
    }

    .bmi-results-consultation-btn {
        width: 100%;
        padding: 14px 28px;
        background-color: #030303;
        color: #ffffff;
        border: none;
        border-radius: 50px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Inter";
    }

    .bmi-results-consultation-btn:hover {
        background-color: #0070da;
        transform: translateY(-2px);
        box-shadow: 2px 4px 12px #00000014;
    }

    .bmi-results-categories {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .bmi-results-category-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 16px;
        background-color: #f8f8f8;
        border-radius: 14px;
        box-shadow: 2px 4px 12px #00000014;
    }

    .bmi-results-category-dot {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        flex-shrink: 0;
    }

    .bmi-results-category-dot.healthy {
        background-color: #4e9a69;
    }

    .bmi-results-category-dot.overweight {
        background-color: #ffa06b;
    }

    .bmi-results-category-dot.obese {
        background-color: #ff6b6b;
    }

    .bmi-results-category-name {
        flex: 1;
        font-size: 15px;
        color: #030303;
        font-weight: 500;
        font-family: "Inter";
    }

    .bmi-results-category-range {
        font-size: 15px;
        color: #666;
        font-weight: 600;
        font-family: "Inter";
    }

    .bmi-results-disclaimers {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .bmi-results-disclaimers p {
        font-size: 11px;
        color: #666;
        line-height: 1.6;
        font-family: "Inter";
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .bmi-container {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .trust-card {
            border-radius: 32px;
            padding: 20px;
        }

        .trust-title {
            font-size: 18px;
            margin-bottom: 12px;
        }

        .trust-list {
            gap: 10px;
            margin-bottom: 12px;
        }

        .trust-list li {
            font-size: 13px;
            padding: 6px 10px;
        }

        .doctor-image {
            height: 110px;
        }

        .doctor-image img {
            width: 140px;
        }

        .doctor-badge {
            font-size: 10px;
            padding: 4px 10px;
        }

        .bmi-results-modal-grid,
        .weight-modal-content {
            grid-template-columns: 1fr;
            gap: 24px;
        }
    }

    @media (max-width: 768px) {
        .bmi-calculator-section {
            padding: 0 20px;
            margin: 12px auto;
        }

        .bmi-container {
            gap: 12px;
        }

        .bmi-input-panel,
        .weight-slider-panel,
        .testimonial-slider-panel {
            padding: 20px 20px;
            border-radius: 32px;
        }

        .testimonial-slider-panel {
            padding: 0;
        }

        .bmi-title {
            font-size: 24px;
        }

        .bmi-subtitle {
            margin-bottom: 12px;
        }

        .bmi-display,
        .weight-number {
            font-size: 70px;
            margin-bottom: 12px;
        }

        .weight-unit {
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .slider-label {
            margin-bottom: 10px;
        }

        .weight-loss-display {
            margin-bottom: 8px;
        }

        .bar-chart {
            margin-bottom: 12px;
        }

        .chart-bars {
            height: 80px;
        }

        .starting-weight-section {
            margin-bottom: 12px;
        }

        .bmi-results-modal-container,
        .weight-modal-container {
            padding: 28px 20px;
            border-radius: 28px;
        }

        .weight-modal-content {
            gap: 24px;
        }

        .bmi-results-modal-close,
        .weight-modal-close {
            top: 2px;
            right: 2px;
        }

        .bmi-results-modal-title {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .bmi-results-modal-grid {
            gap: 24px;
        }

        .bmi-results-circle-container {
            width: 200px;
            height: 200px;
            margin-bottom: 20px;
        }

        .bmi-results-value {
            font-size: 48px;
        }

        .bmi-results-modal-left {
            padding: 28px 20px;
        }

        .bmi-results-modal-right {
            gap: 12px;
        }

        .bmi-results-category-alert {
            padding: 16px;
        }

        .bmi-results-alert-text {
            margin-bottom: 12px;
        }

        .modal-average-label {
            margin-bottom: 10px;
        }

        .modal-percentage {
            font-size: 90px;
            margin-bottom: 10px;
        }

        .percent-symbol {
            font-size: 52px;
        }

        .modal-percentage-text {
            margin-bottom: 20px;
        }

        .modal-get-started-btn {
            margin-bottom: 16px;
        }

        .modal-starting-badge {
            margin-bottom: 16px;
        }

        .modal-lose-label {
            margin-bottom: 10px;
        }

        .modal-weight-loss {
            margin-bottom: 8px;
        }

        .modal-loss-number {
            font-size: 70px;
        }

        .modal-loss-unit {
            font-size: 28px;
        }

        .modal-bar-chart {
            margin-bottom: 16px;
        }

        .modal-weight-card {
            padding: 28px 20px;
        }

        .testimonial-slideshow-bmi {
            min-height: 320px;
        }

        .testimonial-name-bmi {
            font-size: 18px;
        }

        .testimonial-info-bmi {
            padding: 16px;
        }
    }
</style>

<script>
    // Testimonial slideshow for BMI section
    let currentSlideBMI = 0;
    let isPausedBMI = false;
    let slideIntervalBMI: number;

    function showSlideBMI(index: number) {
        const slides = document.querySelectorAll(".slide-bmi");
        slides.forEach((slide, i) => {
            if (i === index) {
                slide.classList.add("active");
            } else {
                slide.classList.remove("active");
            }
        });
    }

    function nextSlideBMI() {
        if (!isPausedBMI) {
            const slides = document.querySelectorAll(".slide-bmi");
            currentSlideBMI = (currentSlideBMI + 1) % slides.length;
            showSlideBMI(currentSlideBMI);
        }
    }

    function startSlideshowBMI() {
        slideIntervalBMI = setInterval(nextSlideBMI, 5000);
    }

    function stopSlideshowBMI() {
        clearInterval(slideIntervalBMI);
    }

    const slideshowBMI = document.querySelector(".testimonial-slideshow-bmi");

    if (slideshowBMI) {
        startSlideshowBMI();

        slideshowBMI.addEventListener("mouseenter", () => {
            isPausedBMI = true;
        });

        slideshowBMI.addEventListener("mouseleave", () => {
            isPausedBMI = false;
        });
    }

    // BMI Calculator
    const feetInput = document.getElementById("feet") as HTMLInputElement;
    const inchesInput = document.getElementById("inches") as HTMLInputElement;
    const weightInput = document.getElementById("weight") as HTMLInputElement;
    const calculateBtn = document.getElementById("calculateBtn");
    const bmiDisplay = document.querySelector(".bmi-display") as HTMLElement;
    const bmiResultsModal = document.getElementById("bmiResultsModal");
    const closeBMIResultsModalBtn = document.getElementById(
        "closeBMIResultsModal",
    );

    // Weight Slider Elements
    const weightSlider = document.getElementById(
        "weightSlider",
    ) as HTMLInputElement;
    const sliderWeightLoss = document.getElementById(
        "sliderWeightLoss",
    ) as HTMLElement;
    const sliderStartingWeight = document.getElementById(
        "sliderStartingWeight",
    ) as HTMLElement;
    const chartBarsContainer = document.getElementById(
        "chartBars",
    ) as HTMLElement;
    const weightModal = document.getElementById("weightModal");
    const closeWeightModalBtn = document.getElementById("closeWeightModal");
    const modalStartingWeight = document.getElementById(
        "modalStartingWeight",
    ) as HTMLElement;
    const modalWeightLoss = document.getElementById(
        "modalWeightLoss",
    ) as HTMLElement;
    const modalChartBars = document.getElementById(
        "modalChartBars",
    ) as HTMLElement;

    let isSliding = false;

    // Generate bar chart - alternating big/small pattern, centered
    function generateBarChart(container: HTMLElement, bars = 40) {
        container.innerHTML = "";
        const isMain = container === chartBarsContainer;
        const barWidth = isMain ? 8 : 6;
        const bigHeight = 95;
        const smallHeight = 50;

        for (let i = 0; i < bars; i++) {
            const bar = document.createElement("div");
            bar.className = isMain ? "chart-bar" : "modal-chart-bar";

            // Alternate between big and small
            const heightPercent = i % 2 === 0 ? bigHeight : smallHeight;

            // Set styles
            bar.style.height = heightPercent + "%";
            bar.style.backgroundColor = "#7cb892";
            bar.style.borderRadius = "4px";
            bar.style.width = barWidth + "px";
            bar.style.flexShrink = "0";

            container.appendChild(bar);
        }
    }

    // Initialize bar charts
    generateBarChart(chartBarsContainer, 60);
    generateBarChart(modalChartBars, 40);

    // Slider-based bar chart animation - scroll bars as slider moves
    function updateBarChartPosition() {
        if (!chartBarsContainer || !weightSlider) return;

        const sliderValue = parseInt(weightSlider.value);
        const sliderMin = parseInt(weightSlider.min);
        const sliderMax = parseInt(weightSlider.max);

        // Calculate slider position as percentage (0 to 1)
        const sliderPercent =
            (sliderValue - sliderMin) / (sliderMax - sliderMin);

        // Fixed scroll range - bars move left as slider increases
        const maxScroll = 200;
        const scrollPosition = -(sliderPercent * maxScroll);

        chartBarsContainer.style.transform = `translateX(${scrollPosition}px)`;
    }

    // Update weight loss based on slider (20%)
    function updateWeightLoss() {
        const currentWeight = parseInt(weightSlider.value);
        const weightLoss = Math.round(currentWeight * 0.2);

        sliderWeightLoss.textContent = weightLoss.toString();
        sliderStartingWeight.textContent = currentWeight.toString();

        // Update bar chart position based on slider
        updateBarChartPosition();
    }

    // Weight slider input event
    weightSlider.addEventListener("input", () => {
        isSliding = true;

        const currentWeight = parseInt(weightSlider.value);
        const weightLoss = Math.round(currentWeight * 0.2);

        sliderWeightLoss.textContent = weightLoss.toString();
        sliderStartingWeight.textContent = currentWeight.toString();

        // Scroll bars based on slider position
        const sliderMin = 140;
        const sliderMax = 400;
        const sliderPercent =
            (currentWeight - sliderMin) / (sliderMax - sliderMin);
        const scrollPosition = -(sliderPercent * 200);

        if (chartBarsContainer) {
            chartBarsContainer.style.transform = `translateX(${scrollPosition}px)`;
        }
    });

    // Weight slider change event (when user releases)
    weightSlider.addEventListener("change", () => {
        if (isSliding) {
            isSliding = false;
            const currentWeight = parseInt(weightSlider.value);
            const weightLoss = Math.round(currentWeight * 0.2);

            // Update modal values
            modalStartingWeight.textContent = currentWeight.toString();
            modalWeightLoss.textContent = weightLoss.toString();

            // Regenerate modal bar chart
            generateBarChart(modalChartBars, 40);

            // Show modal
            weightModal?.classList.add("active");
            document.body.style.overflow = "hidden";
        }
    });

    // Close weight modal
    function closeWeightModal() {
        weightModal?.classList.remove("active");
        document.body.style.overflow = "";
    }

    closeWeightModalBtn?.addEventListener("click", closeWeightModal);

    weightModal?.addEventListener("click", (e) => {
        if (e.target === weightModal) {
            closeWeightModal();
        }
    });

    // BMI Calculator
    function updateModalBMI(bmi: number) {
        const bmiResultsValue = document.getElementById(
            "bmiResultsValue",
        ) as HTMLElement;
        const categoryResultsAlert = document.getElementById(
            "categoryResultsAlert",
        ) as HTMLElement;
        const alertResultsCategory = document.getElementById(
            "alertResultsCategory",
        ) as HTMLElement;
        const alertResultsRange = document.getElementById(
            "alertResultsRange",
        ) as HTMLElement;
        const alertResultsText = document.getElementById(
            "alertResultsText",
        ) as HTMLElement;
        const bmiResultsArc = document.getElementById(
            "bmiResultsArc",
        ) as SVGCircleElement;

        bmiResultsValue.textContent = bmi.toFixed(1);

        let category: string, color: string, range: string, text: string;

        if (bmi < 18.5) {
            category = "Underweight";
            color = "#89cff0";
            range = "< 18.5";
            text =
                "Your BMI is below the healthy range. A licensed provider can help explore the underlying causes and guide you toward a safe, sustainable plan for reaching a healthier weight.";
        } else if (bmi < 25) {
            category = "Healthy Weight";
            color = "#4e9a69";
            range = "18.5+";
            text =
                "Your BMI is within the healthy range. Maintaining a balanced diet and regular exercise can help you stay healthy.";
        } else if (bmi < 30) {
            category = "Overweight";
            color = "#ffa06b";
            range = "25+";
            text =
                "Your BMI indicates you are overweight. A licensed provider can help you develop a personalized plan to reach a healthier weight.";
        } else {
            category = "Obesity";
            color = "#ff6b6b";
            range = "30+";
            text =
                "Your BMI indicates obesity. We recommend consulting with a licensed provider to explore treatment options that may be right for you.";
        }

        alertResultsCategory.textContent = category;
        alertResultsRange.textContent = range;
        alertResultsText.textContent = text;
        categoryResultsAlert.style.borderColor = color;
        bmiResultsArc.setAttribute("stroke", color);

        const percentage = Math.min(bmi / 40, 1);
        const dashOffset = 502 - 502 * percentage * 0.75;
        bmiResultsArc.setAttribute("stroke-dashoffset", dashOffset.toString());
    }

    function calculateBMI() {
        const feet = parseFloat(feetInput.value) || 0;
        const inches = parseFloat(inchesInput.value) || 0;
        const weight = parseFloat(weightInput.value) || 0;

        if (feet === 0 || weight === 0) {
            alert("Please enter valid height and weight");
            return;
        }

        const totalInches = feet * 12 + inches;
        const bmi = (weight / (totalInches * totalInches)) * 703;
        bmiDisplay.textContent = bmi.toFixed(1);

        updateModalBMI(bmi);
        bmiResultsModal?.classList.add("active");
        document.body.style.overflow = "hidden";
    }

    function closeBMIResultsModal() {
        bmiResultsModal?.classList.remove("active");
        document.body.style.overflow = "";
    }

    calculateBtn?.addEventListener("click", calculateBMI);
    closeBMIResultsModalBtn?.addEventListener("click", closeBMIResultsModal);

    [feetInput, inchesInput, weightInput].forEach((input) => {
        input?.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
                calculateBMI();
            }
        });
    });

    bmiResultsModal?.addEventListener("click", (e) => {
        if (e.target === bmiResultsModal) {
            closeBMIResultsModal();
        }
    });

    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
            if (bmiResultsModal?.classList.contains("active")) {
                closeBMIResultsModal();
            }
            if (weightModal?.classList.contains("active")) {
                closeWeightModal();
            }
        }
    });

    // Initialize weight loss display
    updateWeightLoss();
</script>
