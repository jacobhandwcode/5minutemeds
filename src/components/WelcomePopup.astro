---
// WelcomePopup.astro - 10% off signup popup
---

<div class="popup-overlay" id="welcomePopup">
    <div class="popup-container">
        <!-- Close Button -->
        <button class="popup-close" id="closePopup" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path
                    d="M18 6L6 18M6 6l12 12"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"></path>
            </svg>
        </button>

        <!-- Decorative gradient bar -->
        <div class="popup-gradient-bar"></div>

        <div class="popup-content">
            <!-- Icon -->
            <div class="popup-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                    <path
                        d="M12 2L4 6v6c0 5.5 3.84 10.74 8 12 4.16-1.26 8-6.5 8-12V6l-8-4z"
                        stroke="#3a3a3a"
                        stroke-width="2"
                        fill="none"></path>
                    <path
                        d="M9 12l2 2 4-4"
                        stroke="#3a3a3a"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>
                    <defs>
                        <linearGradient
                            id="gradient1"
                            x1="0%"
                            y1="0%"
                            x2="100%"
                            y2="100%"
                        >
                            <stop offset="0%" stop-color="#fb6fec"></stop>
                            <stop offset="100%" stop-color="#84a9fa"></stop>
                        </linearGradient>
                    </defs>
                </svg>
            </div>

            <!-- Headline -->
            <h2 class="popup-headline">
                Your Health, Handled in Minutes.
                <span class="highlight">Start With 10% Off.</span>
            </h2>

            <!-- Body -->
            <p class="popup-body">
                Sign up now and receive <strong>10% off</strong> your first order
                on ALL treatments and consultations.
            </p>

            <!-- Form -->
            <form class="popup-form" id="signupForm">
                <!-- Contact Method Toggle -->
                <div class="contact-toggle">
                    <button
                        type="button"
                        class="toggle-btn active"
                        data-method="email"
                    >
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <path
                                d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                            <path
                                d="M22 6l-10 7L2 6"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                        </svg>
                        Email
                    </button>
                    <button
                        type="button"
                        class="toggle-btn"
                        data-method="phone"
                    >
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <path
                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                        </svg>
                        Phone
                    </button>
                </div>

                <!-- Email Input -->
                <div class="input-container" id="emailContainer">
                    <div class="input-wrapper">
                        <svg
                            class="input-icon"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <path
                                d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                            <path
                                d="M22 6l-10 7L2 6"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                        </svg>
                        <input
                            type="email"
                            id="emailInput"
                            name="email"
                            placeholder="Enter your email address"
                            required
                        />
                    </div>
                </div>

                <!-- Phone Input -->
                <div class="input-container hidden" id="phoneContainer">
                    <div class="input-wrapper">
                        <svg
                            class="input-icon"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                        >
                            <path
                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                        </svg>
                        <input
                            type="tel"
                            id="phoneInput"
                            name="phone"
                            placeholder="Enter your phone number"
                            pattern="[0-9]{10,}"
                        />
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="submit-btn">
                    Start My Visit
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M5 12h14M12 5l7 7-7 7"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"></path>
                    </svg>
                </button>
            </form>

            <!-- Terms -->
            <p class="popup-terms">
                By signing up, you agree to receive marketing emails and texts.
                Unsubscribe anytime.
            </p>
        </div>
    </div>
</div>

<style>
    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        visibility: hidden;
        transition:
            opacity 0.4s ease,
            visibility 0.4s ease;
    }

    .popup-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .popup-container {
        background-color: #ffffff;
        border-radius: 32px;
        max-width: 480px;
        width: 100%;
        position: relative;
        box-shadow:
            0 24px 48px rgba(0, 0, 0, 0.2),
            0 0 1px rgba(0, 0, 0, 0.1);
        transform: scale(0.9) translateY(20px);
        transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        overflow: hidden;
    }

    .popup-overlay.active .popup-container {
        transform: scale(1) translateY(0);
    }
    .popup-close {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 40px;
        height: 40px;
        background-color: #f8f9fa;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        padding: 0;
        color: #666;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 10;
    }

    .popup-close:hover {
        background-color: #e8e9ea;
        transform: rotate(90deg);
        color: #1a1a1a;
    }

    .popup-content {
        padding: 40px 36px 36px 36px;
        text-align: center;
    }

    .popup-icon {
        margin-bottom: 20px;
        animation: pulse 2s ease-in-out infinite;
    }

    .popup-icon svg {
        height: 60px;
    }

    @keyframes pulse {
        0%,
        100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }

    .popup-headline {
        font-family: "Sofia", sans-serif;
        font-size: 28px;
        font-weight: 400;
        color: #1a1a1a;
        margin: 0 0 12px 0;
        line-height: 1.3;
    }

    .popup-headline .highlight {
        display: block;
    background: linear-gradient(135deg, #006bff 0%, #84a9fa 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .popup-body {
        font-family: "Inter", sans-serif;
        font-size: 15px;
        color: #666;
        line-height: 1.6;
        margin: 0 0 28px 0;
    }

    .popup-body strong {
        color: #1a1a1a;
        font-weight: 600;
    }

    /* Form Styles */
    .popup-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .contact-toggle {
        display: flex;
        background-color: #f8f9fa;
        border-radius: 12px;
        padding: 4px;
        gap: 4px;
    }

    .toggle-btn {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 16px;
        background: transparent;
        border: none;
        border-radius: 10px;
        font-family: "Inter", sans-serif;
        font-size: 14px;
        font-weight: 600;
        color: #666;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .toggle-btn:hover {
        color: #1a1a1a;
    }

    .toggle-btn.active {
        background: #ffffff;
        color: #1a1a1a;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .toggle-btn svg {
        stroke: currentColor;
    }

    .input-container {
        transition: all 0.3s ease;
    }

    .input-container.hidden {
        display: none;
    }

    .input-wrapper {
        position: relative;
        background-color: #f8f9fa;
        border-radius: 14px;
        border: 2px solid #e8e9ea;
        transition: all 0.3s ease;
    }

    .input-wrapper:focus-within {
        border-color: #fb6fec;
        background-color: #ffffff;
        box-shadow: 0 0 0 4px rgba(251, 111, 236, 0.1);
    }

    .input-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        stroke: #999;
        pointer-events: none;
        transition: stroke 0.3s ease;
    }

    .input-wrapper:focus-within .input-icon {
        stroke: #fb6fec;
    }

    .input-wrapper input {
        width: 100%;
        padding: 16px 16px 16px 48px;
        font-size: 15px;
        border: none;
        background: transparent;
        outline: none;
        color: #1a1a1a;
        font-family: "Inter", sans-serif;
    }

    .input-wrapper input::placeholder {
        color: #999;
    }

    .submit-btn {
        position: relative;
        width: 100%;
        padding: 16px 24px;
        background-color: #ffffff;
        border: none;
        border-radius: 50px;
        font-family: "Inter", sans-serif;
        font-size: 16px;
        font-weight: 700;
        color: #1a1a1a;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: all 0.3s ease;
        z-index: 1;
        margin-top: 8px;
    }

    .submit-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 50px;
        padding: 3px;
        background: linear-gradient(
            135deg,
            #fdd4a3,
            #fba69e 20%,
            #fb6fec 40%,
            #84a9fa 60%,
            #90dcf7 80%,
            #c7e9ab
        );
        -webkit-mask:
            linear-gradient(#fff 0 0) content-box,
            linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        z-index: -1;
        transition: all 0.3s ease;
    }

    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(251, 111, 236, 0.3);
    }

    .submit-btn:hover::before {
        background: linear-gradient(
            225deg,
            #fdd4a3,
            #fba69e 20%,
            #fb6fec 40%,
            #84a9fa 60%,
            #90dcf7 80%,
            #c7e9ab
        );
        padding: 3.5px;
    }

    .submit-btn svg {
        stroke: #1a1a1a;
        transition: transform 0.3s ease;
    }

    .submit-btn:hover svg {
        transform: translateX(4px);
    }

    .popup-terms {
        font-family: "Inter", sans-serif;
        font-size: 11px;
        color: #999;
        line-height: 1.5;
        margin: 16px 0 0 0;
    }

    /* Responsive */
    @media (max-width: 520px) {
        .popup-container {
            border-radius: 24px;
            margin: 16px;
        }

        .popup-content {
            padding: 32px 24px 28px 24px;
        }

        .popup-headline {
            font-size: 24px;
        }

        .popup-body {
            font-size: 14px;
            margin-bottom: 24px;
        }

        .toggle-btn {
            padding: 10px 12px;
            font-size: 13px;
        }

        .input-wrapper input {
            padding: 14px 14px 14px 44px;
            font-size: 14px;
        }

        .submit-btn {
            padding: 14px 20px;
            font-size: 15px;
        }
    }
</style>

<script>
    const popup = document.getElementById("welcomePopup");
    const closeBtn = document.getElementById("closePopup");
    const signupForm = document.getElementById("signupForm");
    const toggleBtns = document.querySelectorAll(".toggle-btn");
    const emailContainer = document.getElementById("emailContainer");
    const phoneContainer = document.getElementById("phoneContainer");
    const emailInput = document.getElementById(
        "emailInput",
    ) as HTMLInputElement;
    const phoneInput = document.getElementById(
        "phoneInput",
    ) as HTMLInputElement;

    // Check if popup was already shown in this session
    const popupShown = sessionStorage.getItem("welcomePopupShown");

    // Show popup after a short delay if not already shown
    if (!popupShown) {
        setTimeout(() => {
            popup?.classList.add("active");
            document.body.style.overflow = "hidden";
        }, 1500); // Show after 1.5 seconds
    }

    // Close popup
    function closePopup() {
        popup?.classList.remove("active");
        document.body.style.overflow = "";
        sessionStorage.setItem("welcomePopupShown", "true");
    }

    closeBtn?.addEventListener("click", closePopup);

    // Close on overlay click
    popup?.addEventListener("click", (e) => {
        if (e.target === popup) {
            closePopup();
        }
    });

    // Close on escape key
    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && popup?.classList.contains("active")) {
            closePopup();
        }
    });

    // Toggle between email and phone
    toggleBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            const method = (btn as HTMLButtonElement).dataset.method;

            // Update active state
            toggleBtns.forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");

            // Show/hide inputs
            if (method === "email") {
                emailContainer?.classList.remove("hidden");
                phoneContainer?.classList.add("hidden");
                emailInput.required = true;
                phoneInput.required = false;
            } else {
                emailContainer?.classList.add("hidden");
                phoneContainer?.classList.remove("hidden");
                emailInput.required = false;
                phoneInput.required = true;
            }
        });
    });

    // Form submission
    signupForm?.addEventListener("submit", (e) => {
        e.preventDefault();

        const formData = new FormData(signupForm as HTMLFormElement);
        const data = {
            email: formData.get("email"),
            phone: formData.get("phone"),
        };

        // Here you would send to your backend
        console.log("Signup data:", data);

        // Store that user signed up
        localStorage.setItem("signedUpForDiscount", "true");

        // Close popup and show success (you can customize this)
        closePopup();

        // Optional: Show a toast notification or redirect
        alert("ðŸŽ‰ You're in! Check your inbox for your 10% discount code.");
    });
</script>
